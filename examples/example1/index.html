<!DOCTYPE html>
<html>
  <head>
    <title>Matrix Stack Example</title>
    <link rel="icon" href="../../matrix-stack.ico">
    <script src="../../matrix-stack.js"></script>
  </head>
  <body>
    <canvas width="600" height="600"></canvas>
    <script>
      var canvas, c;
      var rotation = 0, globalScale = 1;
      var prevMouseX = 0, prevMouseY = 0;
      var t = new MatrixStack();	// transformation
      function mouseMoved(e) {
        if (e) {
          globalScale += (e.clientX - prevMouseX) / 100;
          rotation += (e.clientY - prevMouseY) / 100;
          prevMouseX = e.clientX;
          prevMouseY = e.clientY;
        }
        t.loadIdentity();
        t.applyToContext(c);
        c.clearRect(0, 0, 600, 600);
        t.scale(globalScale, globalScale);
        t.rotate(rotation);
        for (var i=0; i<20; i++) {
          t.pushMatrix();
          t.translate(30*i, 0);
          t.scale((20-i)/10, 1);
          t.applyToContext(c);
          c.fillStyle = 'rgba(100,0,0,'+((20-i)/20)+')';
          c.fillRect(0, 0, 20, 20);
          t.popMatrix();
        }
      }
      function load() {
        canvas = document.querySelector('canvas');
        c = canvas.getContext('2d');	// context
        mouseMoved();
      }
      window.addEventListener('load', load);
      window.addEventListener('mousemove', mouseMoved);
    </script>
  </body>
</html>
